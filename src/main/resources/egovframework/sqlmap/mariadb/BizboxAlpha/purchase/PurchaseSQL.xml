<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="PurchaseSQL">

	<select	id="PurchaseSQL.getGroupInfo" parameterClass="HashMap" resultClass="HashMap">
		select * from $DB_NEOS$t_co_group
	</select>
	
	
	<select	id="PurchaseSQL.SelectPurchaseDetail" parameterClass="HashMap" resultClass="HashMap">
		
		SELECT 
		a.seq, 
		a.manage_no, 
		a.write_comp_seq, 
		a.write_dept_seq, ifnull(dm.dept_name,'') as write_dept_name, 
		a.write_emp_seq, ifnull(em.emp_name,'') as write_emp_name, 
		a.write_dt,
		ifnull(a.title, '') as title,
		ifnull(a.doc_sts,'') as doc_sts,
		ifnull(a.approkey_purchase,'') as approkey_purchase, 
		ifnull(a.approkey_check,'') as approkey_check, 
		ifnull(a.purchase_method,'') as purchase_method,
		ifnull(a.purchase_type,'') as purchase_type,
		ifnull(a.pay_type_info,'') as pay_type_info,
		ifnull(a.public_info,'') as public_info,
		a.created_dt, 
		a.created_by, 
		a.modify_dt, 
		a.modify_by
		FROM cust_sto.t_purchase_purchase a
		left join $DB_NEOS$t_co_dept_multi dm on a.write_dept_seq = dm.dept_seq and dm.lang_code = 'kr'
		left join $DB_NEOS$t_co_emp_multi em on a.write_emp_seq = em.emp_seq and em.lang_code = 'kr'
		
		where a.seq = $seq$
		limit 1;
	</select>		
	
	
	<insert	id="PurchaseSQL.InsertPurchase" parameterClass="HashMap" >
	
		INSERT INTO cust_sto.t_purchase_purchase
		(
		manage_no, 
		write_comp_seq, 
		write_dept_seq, 
		write_emp_seq, 
		write_dt,	
		
		title, 
		purchase_method, 
		purchase_type, 
		pay_type_info,
		public_info,			 
		 
		created_dt, 
		created_by, 
		modify_dt, 
		modify_by
		
		)
		VALUES(
		'', 
		'$write_comp_seq$', 
		'$write_dept_seq$', 
		'$write_emp_seq$', 
		'$write_dt$',		 

		'$title$', 
		'$purchase_method$', 
		'$purchase_type$', 
		'$pay_type_info$',
		'$public_info$', 
			
		now(), 
		'$created_by$', 
		null, 
		null
		);
		
		<selectKey keyProperty="seq" resultClass="int">
			SELECT LAST_INSERT_ID();
		</selectKey>	

	</insert>	
	
	
	<update	id="PurchaseSQL.UpdatePurchase" parameterClass="HashMap" >
		UPDATE cust_sto.t_purchase_purchase
		SET
		write_comp_seq='$write_comp_seq$', 
		write_dept_seq='$write_dept_seq$', 
		write_emp_seq='$write_emp_seq$', 
		write_dt='$write_dt$',		 
		
		title='$title$',
		purchase_method='$purchase_method$',
		purchase_type='$purchase_type$',
		pay_type_info='$pay_type_info$',
		public_info='$public_info$',
		
		modify_dt=now(), 
		modify_by='$created_by$'
		
		WHERE seq='$seq$'; 
	</update>		
	
	
	<delete	id="PurchaseSQL.DeleteItemInfo" parameterClass="HashMap" >
		
		delete from cust_sto.t_purchase_item_info where seq = '$seq$' and outProcessCode = '$outProcessCode$';

	</delete>	
	
	<insert	id="PurchaseSQL.InsertItemInfo" parameterClass="HashMap" >

		INSERT INTO cust_sto.t_purchase_item_info
		(
		seq, 
		outProcessCode, 
		item_idn_no, 
		item_div_no, 
		item_name, 
		item_amt, 
		item_fee_amt, 
		item_total_amt, 
		item_total_amt_text, 
		item_cnt, 
		item_deadline, 
		item_acquisition_reason, 
		item_inventory_cd, 
		item_unit, 
		item_use_location, 
		item_contry, 
		item_pickup_location, 
		item_green_cert_type, 
		item_non_green_reason, 
		item_green_class, 
		item_foreign_type, 
		created_dt, 
		created_by
		)
		VALUES(
		'$seq$', 
		'$outProcessCode$',
		'$item_idn_no$',
		'$item_div_no$',
		'$item_name$',
		'$item_amt$',
		'$item_fee_amt$',
		'$item_total_amt$',
		'$item_total_amt_text$',
		'$item_cnt$',
		'$item_deadline$',
		'$item_acquisition_reason$',
		'$item_inventory_cd$',
		'$item_unit$',
		'$item_use_location$',
		'$item_contry$',
		'$item_pickup_location$',
		'$item_green_cert_type$',
		'$item_non_green_reason$',
		'$item_green_class$',
		'$item_foreign_type$',
		now(), 
		'$created_by$'
		);

	</insert>	
	
	
	<select	id="PurchaseSQL.SelectItemList" parameterClass="HashMap" resultClass="HashMap">
		
		SELECT 
		seq, 
		outProcessCode, 
		item_idn_no, 
		item_div_no, 
		item_name,
		FORMAT(item_amt, 0) as item_amt,
		FORMAT(item_fee_amt, 0) as item_fee_amt,
		FORMAT(item_total_amt, 0) as item_total_amt, 
		item_total_amt_text, 
		item_cnt, 
		item_deadline, 
		item_acquisition_reason, 
		item_inventory_cd, 
		item_unit, 
		item_use_location, 
		item_contry, 
		item_pickup_location, 
		item_green_cert_type, 
		item_non_green_reason, 
		item_green_class, 
		item_foreign_type, 
		created_dt, 
		created_by
		FROM cust_sto.t_purchase_item_info 
		where '$seq$' and outProcessCode = '$outProcessCode$';

	</select>		
	
		
</sqlMap>