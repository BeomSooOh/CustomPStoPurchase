<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="PurchaseSQL">

	<select	id="PurchaseSQL.getGroupInfo" parameterClass="HashMap" resultClass="HashMap">
		select * from $DB_NEOS$t_co_group
	</select>
	
	<select	id="PurchaseSQL.getGroupPathInfo" parameterClass="HashMap" resultClass="HashMap">
		select * from $DB_NEOS$t_co_group_path where os_type = #osType# and path_seq = #pathSeq#
	</select>	
	
	<select	id="PurchaseSQL.SelectPurchaseDetailCodeList" parameterClass="HashMap" resultClass="HashMap">
		
		select
		`GROUP`, CODE, NAME, USE_YN, ORDER_NUM, NOTE, LINK
		from cust_sto.t_purchase_code_detail 
		where 1=1
		<isNotEmpty property="useYn">
		and USE_YN = '$useYn$'
		</isNotEmpty>		
		<isNotEmpty property="group">
		and `group`='$group$'
		</isNotEmpty>
		order by `GROUP`, ORDER_NUM
	</select>
	
	<select	id="PurchaseSQL.SelectContractList" parameterClass="HashMap" resultClass="HashMap">
		
		SELECT 
		seq, 
		manage_no, 
		contract_no,
		write_comp_seq, 
		write_dept_seq, 
		write_emp_Seq, 
		write_dt, 
		noti_type, 
		budget_type, 
		target_type, 
		title, 
		contract_start_dt, 
		contract_end_dt, 
		amt, 
		std_amt, 
		tax_amt, 
		base_law, 
		pay_type_info, 
		work_info, 
		emergency_yn, 
		restrict_sector_yn, 
		compete_type, 
		restrict_sector_info, 
		restrict_area_info, 
		nominee_info, 
		decision_type_info, 
		contract_form1, 
		contract_form2, 
		contract_form3, 
		rebid_yn, 
		eorder_use_yn, 
		created_dt, 
		created_by, 
		modify_dt, 
		modify_by
		FROM cust_sto.t_purchase_contract;
		
	</select>	
	
	<select	id="PurchaseSQL.SelectContractDetail" parameterClass="HashMap" resultClass="HashMap">
		
		SELECT 
		seq, 
		manage_no, 
		contract_no,
		write_comp_seq, 
		write_dept_seq, 
		write_emp_Seq, 
		write_dt, 
		noti_type, 
		budget_type, 
		target_type, 
		title, 
		contract_start_dt, 
		contract_end_dt, 
		amt, 
		std_amt, 
		tax_amt, 
		base_law, 
		pay_type_info, 
		work_info, 
		emergency_yn, 
		restrict_sector_yn, 
		compete_type, 
		restrict_sector_info, 
		restrict_area_info, 
		nominee_info, 
		decision_type_info, 
		contract_form1, 
		contract_form2, 
		contract_form3, 
		rebid_yn, 
		eorder_use_yn, 
		created_dt, 
		created_by, 
		modify_dt, 
		modify_by
		FROM cust_sto.t_purchase_contract
		where seq = $seq$
		
	</select>	
	
	<select	id="PurchaseSQL.SelectContractSeqFromManageNo" parameterClass="HashMap" resultClass="int">
		
		SELECT 
		seq
		FROM cust_sto.t_purchase_contract
		where manage_no = '$manage_no$'
		
	</select>	
	
	<insert	id="PurchaseSQL.InsertContract" parameterClass="HashMap" >
		
		<selectKey keyProperty="manage_no" resultClass="java.lang.String">
		select concat('$budget_type$', '-', YEAR(now()), '-', LPAD( ifnull( (select max(substr(manage_no, 9)) from cust_sto.t_purchase_contract where manage_no like concat('$budget_type$-',YEAR(now()),'-%')) , '0') + 1 , 4, '0')) as manage_no from dual		
	    </selectKey>		
		
		INSERT INTO cust_sto.t_purchase_contract
		(
		manage_no, 
		contract_no,
		write_comp_seq, 
		write_dept_seq, 
		write_emp_Seq, 
		write_dt, 
		noti_type, 
		budget_type, 
		target_type, 
		title, 
		contract_start_dt, 
		contract_end_dt, 
		amt, 
		std_amt, 
		tax_amt, 
		base_law, 
		pay_type_info, 
		work_info, 
		emergency_yn, 
		restrict_sector_yn, 
		compete_type, 
		restrict_sector_info, 
		restrict_area_info, 
		nominee_info, 
		decision_type_info, 
		contract_form1, 
		contract_form2, 
		contract_form3, 
		rebid_yn, 
		eorder_use_yn, 
		created_dt, 
		created_by, 
		modify_dt, 
		modify_by
		
		)
		VALUES(
		'$manage_no$', 
		'$contract_no$',
		'$write_comp_seq$', 
		'$write_dept_seq$', 
		'$write_emp_Seq$', 
		'$write_dt$', 
		'$noti_type$', 
		'$budget_type$', 
		'$target_type$', 
		'$title$', 
		'$contract_start_dt$', 
		'$contract_end_dt$', 
		'$amt$', 
		'$std_amt$', 
		'$tax_amt$', 
		'$base_law$', 
		'$pay_type_info$', 
		'$work_info$', 
		'$emergency_yn$', 
		'$restrict_sector_yn$', 
		'$compete_type$', 
		'$restrict_sector_info$', 
		'$restrict_area_info$', 
		'$nominee_info$', 
		'$decision_type_info$', 
		'$contract_form1$', 
		'$contract_form2$', 
		'$contract_form3$', 
		'$rebid_yn$', 
		'$eorder_use_yn$', 
		now(), 
		'$created_by$', 
		null, 
		null
		);

	</insert>	
	
	<delete	id="PurchaseSQL.DeleteAttachInfo" parameterClass="HashMap" >
		
		delete from cust_sto.t_purchase_attach_info where seq = '$seq$' and outProcessCode = '$outProcessCode$';

	</delete>	
	
	<insert	id="PurchaseSQL.InsertAttachInfo" parameterClass="HashMap" >

		INSERT INTO cust_sto.t_purchase_attach_info
		(file_id, file_name, file_ext, seq, outProcessCode, form_code, use_yn, created_dt, created_by)
		VALUES('$fileId$', '$fileName$', '$fileExt$', '$seq$', '$outProcessCode$', '$code$', 'Y', now(), '$created_by$');		

	</insert>		
	
	
	<select	id="PurchaseSQL.SelectAttachList" parameterClass="HashMap" resultClass="HashMap">
		
		select * 
		from cust_sto.t_purchase_attach_info where seq = '$seq$' and outProcessCode = '$outProcessCode$'
		
	</select>		
	
	
	
	
</sqlMap>